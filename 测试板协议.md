# 测试板协议

## 协议组成
|帧头|有效数据长度|指令字|有效数据内容|校验|帧尾|
|-|-|-|-|-|-|
|2 Bytes|2 Bytes| 1 Byte| N Bytes | 2 Bytes| 2 Bytes|
|0xEB 0x90|有效数据段的字节总数 N|用于区分是什么指令消息|指令消息的具体内容段|从帧头开始，到有效数据内容结束共 5 + N 字节的 CRC16 校验| 0xAA 0xBB|
---

## PC 发送给测试板协议
|指令字|说明|
|-|-|
|1|设置测试板输出信号|
|2|设置测试板串口输出数据|
|3|设置测试板 CAN 口输出数据|
|4|设置测试板 CAN 口过滤器|
|5|设置测试板串口转发数据|
|6|设置测试板 SBUS 口发出数据|


### 指令字 1 设置测试板输出信号
通过此指令消息，可设置放侧板上各 PWM, IO, DA 输出接口信号的值。

有效数据部分: 
|内容|长度|说明|
|-|-|-|
|信号类型|1 Byte|区分是设置什么信号|
|接口序号|1 Byte|要设置的信号是第几路|
|信号值|2 Bytes|给定信号的值|

信号类型分配和值说明: 
|序号|信号类型|接口序号|信号值|
|-|-|-|-|
|1|PWM 输出||输出的 PWM 高电平时间，500 ~ 2500|
|2|IO 输出||输出的 IO 高低状态，0-低电平，1-高电平|
|3|DA 输出||输出的 DA 电压，单位 0.1V, 范围 0~60V|

### 指令字 2 设置测试板串口输出数据
通过此指令消息，可指定从仿测板的某个串口输出给定的数据。

有效数据部分: 
|内容|长度|说明|
|-|-|-|
|串口序号|1 Byte|指定要从哪个串口输出数据|
|数据内容|n Bytes|要从该串口输出的数据内容|

### 指令字 3 设置测试板 CAN 口输出数据
通过此指令消息，可指定从仿测板的 CAN 口输出给定的数据。

有效数据部分: 
|内容|长度|说明|
|-|-|-|
|CAN 数据帧ID类型|1 Byte|0-标准帧 1-扩展帧|
|CAN 数据帧ID|4 Bytes||
|CAN 数据帧长度 DLC| 1 Bytes|0~8|
|CAN 数据帧内容|0~8 Bytes|

### 指令字 4 设置测试板 CAN 口过滤器
通过此指令消息，可对仿测板的 CAN 接口过滤器进行配置。

有效数据部分: 
|内容|长度|说明|
|-|-|-|
|是否开启过滤| 1 Byte| 0-不开启 1-开启|
|过滤的 ID | 4 Bytes||

### 指令字 5 设置试板串口/CAN 口转发数据
通过此指令消息，可将指定的仿测板与外部设备链接的串口或 CAN 口数据，配置为转发给 PC 的串口上。

有效数据部分: 
|内容|长度|说明|
|-|-|-|
|是否启用该串口/CAN 的转发|1 Byte|0-不启用 1-启用|
|待转发的数据接口序号|1 Byte||
|数据转发到哪个PC串口|1 Byte||

### 指令字 6 设置测试板 SBUS 口发出数据
通过此指令，设置测试板 SBUS 输出接口的数据

有效数据部分: 
|内容|长度|说明|
|-|-|-|
|SBUS 14 输入通道的各通道值|2 * 14 Byte|每通道都是 1000 ~ 2000|


---

## 测试板发送给 PC 协议
|指令字|说明|
|-|-|
|1|指令消息应答|
|2|仿测板输入输出信号接口状态反馈|
|3|仿测板转发串口接口数据|
|4|仿测板转发 CAN 口接口数据|

### 指令字 1 指令消息应答
每次接口到 PC 指令消息后，反馈此消息

有效数据部分: 
|内容|长度|说明|
|-|-|-|
|应答指令消息号|1 Byte|接收到 PC 的指令消息号|

### 指令字 2 仿测板输入输出信号接口状态反馈
仿测板 10 hz 定期往 PC 串口主动发送此指令

有效数据部分:
|内容|长度|说明|
|-|-|-|
|PWM 输入通道值|||
|PWM 输出通道值|||
|IO 输入状态|||
|IO 输出状态|||
|AD 输入电压|||
|DA 输出电压|||
|SBUS 输入通道值|||
|SBUS 输出通道值|||

### 指令字 3 仿测板转发串口接口数据
PC 设置串口数据转发后，待转发的串口接收到的数据，将会按照此指令，转发给 PC

有效数据部分:
|内容|长度|说明|
|-|-|-|
|数据来源串口序号|-|-|
|转发数据长度|-|-|
|转发数据内容|-|-|

### 指令字 4 仿测板转发 CAN 口接口数据
PC 设置 CAN 口数据转发后


